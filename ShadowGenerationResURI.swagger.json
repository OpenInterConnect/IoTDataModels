{
  "swagger":"2.0",
  "info":{
    "title":"ShadowGeneration",
    "version":"20190402",
    "license":{
      "name":"OCF Data Model License",
      "url":"https://github.com/openconnectivityfoundation/core/blob/e28a9e0a92e17042ba3e83661e4c0fbce8bdc4ba/LICENSE.md",
      "x-copyright":"copyright 2016-2017, 2019 Open Connectivity Foundation, Inc. All rights reserved."
    },
    "termsOfService":"https://openconnectivityfoundation.github.io/core/DISCLAIMER.md"
  },
  "schemes":[
    "http"
  ],
  "consumes":[
    "application/json"
  ],
  "produces":[
    "application/json"
  ],
  "paths":{
    "/ShadowGenerationResURI":{
      "get":{
        "description":"This Resource is hosted in a Shadow Service where it serves as a factory Resource for generating Shadow Devices.\nA Mediator shall be pre-provisioned with the URI and access to this Resource.",
        "parameters":[
          {
            "$ref":"#/parameters/interface"
          }
        ],
        "responses":{
          "200":{
            "description":"Retrieves the baseline properties of the Shadow Generation Resource.",
            "x-example":{
              "rt":[
                "oic.wk.shadow.gen"
              ],
              "if":[
                "oic.if.rw",
                "oic.if.baseline"
              ],
              "n":"ShadowGen",
              "id":"0_ShadowGen"
            },
            "schema":{
              "$ref":"#/definitions/baseline"
            }
          }
        }
      },
      "post":{
        "description":"To generate a Shadow Device, the Mediator issues a CREATE request with a payload that includes the following properties:\n The property \"di\" contains the identity (UUID) of the Mediator.\n The property \"ode\" is an array in which each item is an \"ep\" value as extracted from the \"eps\" list of the Original Device's /oic/res link.\n The property \"ssr\" is an array in which each item is a URI of the Original Device's \"oic.wk.shadow.sync\" Resource.\n The property \"ttl\" indicates the maximum idle lifetime (in seconds) of the Shadow Device.\n The \"resources\" property is an array of Resources on the Original Device to be copied to and synchronized with the Shadow Device.",
        "parameters":[
          {
            "$ref":"#/parameters/interface"
          },
          {
            "name":"body",
            "in":"body",
            "required":true,
            "schema":{
              "$ref":"#/definitions/ShadowGenerationRequest"
            },
            "x-example":{
              "di":"50590fd0-a11b-4b95-af91-27c69f4a5824",
              "ttl":600,
              "ssr":[
                "coaps://[fe80::b1e6]:55555/oic/shadow/sync"
              ],
              "ode":[
                "coaps://[fe80::b1e6]:55555"
              ],
              "resources":[
                {
                  "href":"/temperature",
                  "p":{
                    "bm":1
                  },
                  "rt":[
                    "oic.r.temperature"
                  ],
                  "if":[
                    "oic.if.a",
                    "oic.if.s",
                    "oic.if.baseline"
                  ]
                },
                {
                  "href":"/oic/d",
                  "p":{
                    "bm":1
                  },
                  "rt":[
                    "oic.wk.d",
                    "oic.d.sensor"
                  ],
                  "if":[
                    "oic.if.r",
                    "oic.if.baseline"
                  ],
                  "rep":{
                    "rt":[
                      "oic.wk.d",
                      "oic.d.sensor"
                    ],
                    "if":[
                      "oic.if.r",
                      "oic.if.baseline"
                    ],
                    "di":"20590fd0-a11b-4b95-af91-27c69f4a5824",
                    "icv":"ocf.2.0.0",
                    "dmv":"ocf.res.1.0.0",
                    "dmn":"foo labs",
                    "dmno":"bar product xxx"
                  }
                }
              ]
            }
          }
        ],
        "responses":{
          "200":{
            "description":"Upon successful creation of the Shadow Device, this Resource returns a response to the Mediator containing the Links of \"oic.wk.res\" and \"oic.wk.shadow.sync\" Resources in the Shadow Device.",
            "x-example":[
              {
                "href":"/oic/shadow/sync",
                "anchor":"ocf://40590fd0-a11b-4b95-af91-27c69f4a5824",
                "rt":[
                  "oic.wk.shadow.sync"
                ],
                "if":[
                  "oic.if.rw",
                  "oic.if.baseline"
                ],
                "p":{
                  "bm":0
                },
                "eps":[
                  {
                    "ep":"coaps://[fe80::b1d6]:2222"
                  }
                ]
              },
              {
                "href":"/oic/res",
                "anchor":"ocf://40590fd0-a11b-4b95-af91-27c69f4a5824",
                "rt":[
                  "oic.wk.res"
                ],
                "if":[
                  "oic.if.r",
                  "oic.if.baseline"
                ],
                "p":{
                  "bm":3
                },
                "eps":[
                  {
                    "ep":"coaps://[fe80::b1d6]:2222"
                  }
                ]
              }
            ],
            "schema":{
              "$ref":"#/definitions/ShadowGenerationResponse"
            }
          },
          "403":{
            "description":"This response is generated by the Shadow Service when:\n The Mediator fails to at a minimum include the following in its CREATE request:\n  One or more Non-Configuration Resources (NCRs).\n  The Original Device's /oic/d link parameters and representation in the \"resources\" property.\n When the Shadow Service experiences internal errors in constructing and launching a Shadow Device."
          }
        }
      }
    }
  },
  "parameters":{
    "interface":{
      "in":"query",
      "name":"if",
      "type":"string",
      "enum":[
        "oic.if.rw",
        "oic.if.baseline"
      ]
    }
  },
  "definitions":{
    "baseline":{
      "properties":{
        "rt":{
          "description":"The Resource Type.",
          "items":{
            "enum":[
              "oic.wk.shadow.gen"
            ],
            "type":"string",
            "maxLength":64
          },
          "minItems":1,
          "uniqueItems":true,
          "readOnly":true,
          "type":"array"
        },
        "if":{
          "description":"The OCF Interface set supported by this Resource.",
          "items":{
            "enum":[
              "oic.if.rw",
              "oic.if.baseline"
            ],
            "type":"string",
            "maxLength":64
          },
          "minItems":2,
          "readOnly":true,
          "uniqueItems":true,
          "type":"array"
        },
        "n":{
          "$ref":"https://openconnectivityfoundation.github.io/core/schemas/oic.common.properties.core-schema.json#/definitions/n"
        },
        "id":{
          "$ref":"https://openconnectivityfoundation.github.io/core/schemas/oic.common.properties.core-schema.json#/definitions/id"
        }
      },
      "type":"object",
      "required":[
        "rt",
        "if"
      ]
    },
    "ShadowGenerationRequest":{
      "properties":{
        "di":{
          "description":"The identity (UUID) of the Mediator.",
          "$ref":"#/definitions/uuid"
        },
        "ttl":{
          "description":"The maximum idle lifetime (in seconds) of the Shadow Device during periods of inactivity.",
          "default":600,
          "type":"integer"
        },
        "ode":{
          "description":"Array of \"ep\" values  extracted from the \"eps\" list of the Original Device's /oic/res Link.",
          "items":{
            "format":"uri",
            "type":"string"
          },
          "minItems":1,
          "uniqueItems":true,
          "type":"array"
        },
        "ssr":{
          "description":"Array of URIs of the Original Device's \"oic.wk.shadow.sync\" Resource.",
          "items":{
            "format":"uri",
            "type":"string"
          },
          "minItems":1,
          "uniqueItems":true,
          "type":"array"
        },
        "resources":{
          "description":"The array of Resources in the Original Device that shall be synchronized with the Shadow Device.",
          "items":{
            "properties":{
              "href":{
                "description":"This target URI for a Resource in the Original Device specified as a Relative Reference.",
                "format":"uri",
                "maxLength":256,
                "type":"string"
              },
              "rt":{
                "description":"Resource Type of the Resource",
                "items":{
                  "maxLength":64,
                  "type":"string"
                },
                "minItems":1,
                "uniqueItems":true,
                "type":"array"
              },
              "if":{
                "description":"The interface set supported by this Resource",
                "items":{
                  "enum":[
                    "oic.if.baseline",
                    "oic.if.ll",
                    "oic.if.b",
                    "oic.if.rw",
                    "oic.if.r",
                    "oic.if.a",
                    "oic.if.s"
                  ],
                  "type":"string"
                },
                "minItems":1,
                "uniqueItems":true,
                "type":"array"
              },
              "p":{
                "description":"Specifies the framework policies on the Resource referenced by the target URI.",
                "properties":{
                  "bm":{
                    "description":"Specifies the framework policies on the Resource referenced by the target URI for e.g. observable and discoverable.",
                    "type":"integer"
                  }
                },
                "required":[
                  "bm"
                ],
                "type":"object"
              },
              "rep":{
                "description":"The current Resource representation.",
                "type":"object"
              }
            },
            "type":"object",
            "required":[
              "href",
              "rt",
              "if",
              "p"
            ]
          },
          "minItems":2,
          "uniqueItems":true,
          "type":"array"
        }
      },
      "type":"object",
      "required":[
        "di",
        "ttl",
        "ode",
        "resources"
      ]
    },
    "ShadowGenerationResponse":{
      "items":{
        "properties":{
          "eps":{
            "description":"the Endpoint information of the target Resource",
            "items":{
              "properties":{
                "ep":{
                  "description":"Transport Protocol Suite + Endpoint Locator",
                  "format":"uri",
                  "type":"string"
                },
                "pri":{
                  "description":"The priority among multiple Endpoints",
                  "minimum":1,
                  "type":"integer"
                }
              },
              "type":"object"
            },
            "type":"array",
            "minItems":1
          },
          "anchor":{
            "description":"This is used to override the context URI e.g. override the URI of the containing collection.",
            "format":"uri",
            "maxLength":256,
            "type":"string"
          },
          "href":{
            "description":"This target URI for a Resource in the Original Device specified as a Relative Reference.",
            "format":"uri",
            "maxLength":256,
            "type":"string"
          },
          "rt":{
            "description":"Resource Type of the Resource",
            "items":{
              "maxLength":64,
              "type":"string"
            },
            "minItems":1,
            "uniqueItems":true,
            "type":"array"
          },
          "if":{
            "description":"The interface set supported by this Resource",
            "items":{
              "enum":[
                "oic.if.baseline",
                "oic.if.ll",
                "oic.if.b",
                "oic.if.rw",
                "oic.if.r",
                "oic.if.a",
                "oic.if.s"
              ],
              "type":"string"
            },
            "minItems":1,
            "uniqueItems":true,
            "type":"array"
          },
          "p":{
            "description":"Specifies the framework policies on the Resource referenced by the target URI.",
            "properties":{
              "bm":{
                "description":"Specifies the framework policies on the Resource referenced by the target URI for e.g. observable and discoverable.",
                "type":"integer"
              }
            },
            "required":[
              "bm"
            ],
            "type":"object"
          }
        },
        "required":[
          "href",
          "rt",
          "if",
          "anchor",
          "eps"
        ],
        "type":"object"
      },
      "minItems":0,
      "maxItems":2,
      "uniqueItems":true,
      "type":"array"
    },
    "uuid":{
      "description":"Format pattern according to IETF RFC 4122.",
      "pattern":"^[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}$",
      "type":"string"
    }
  }
}
